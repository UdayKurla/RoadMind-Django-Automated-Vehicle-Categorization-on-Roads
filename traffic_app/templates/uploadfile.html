{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Automated Vehicle Categorization</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: '#1E3D59',
        secondary: '#57B5E7'
      },
      borderRadius: {
        'none': '0px',
        'sm': '4px',
        DEFAULT: '8px',
        'md': '12px',
        'lg': '16px',
        'xl': '20px',
        '2xl': '24px',
        '3xl': '32px',
        'full': '9999px',
        'button': '8px'
      }
    }
  }
}
</script>
<style>
  :where([class^="ri-"])::before { content: "\f3c2"; }
  .drag-active { border-style: solid; background-color: rgba(196, 210, 222, 0.1); }
  input[type="file"] { display: none; }
  .upload-progress { transition: width 0.5s ease; }
</style>
</head>
<body class="bg-gray-50">
<nav class="fixed w-full bg-white shadow-md z-50">
  <div class="container mx-auto px-6 py-4">
    <div class="flex items-center justify-between">
      <a href="/" class="text-2xl font-['Pacifico'] text-primary">RoadMind</a>
      <div class="hidden md:flex space-x-6">
        <a href="/#home" class="nav-link">Home</a>
        <a href="/#about" class="nav-link">About</a>
        <a href="/#how-it-works" class="nav-link">How It Works</a>
        <a href="/#team" class="nav-link">Team</a>
        <a href="/uploadfile" class="nav-link active">Try Model</a>
        <a href="/#resources" class="nav-link">Resources</a>
        <a href="/#contact" class="nav-link">Contact</a>
      </div>
    </div>
  </div>
</nav>
<main class="max-w-4xl mx-auto px-4 py-12">
  <div class="bg-white rounded-lg shadow-lg p-8">
    <h1 class="text-3xl font-bold text-primary mb-8 text-center">Upload Your Image</h1>
    <div id="upload-container" class="border-2 border-dashed border-primary rounded-lg p-8 text-center bg-secondary cursor-pointer hover:border-opacity-70 transition-all">
      <div class="flex flex-col items-center justify-center min-h-[300px]">
        <div class="w-16 h-16 flex items-center justify-center text-primary mb-4">
          <i class="ri-upload-cloud-line ri-3x"></i>
        </div>
        <!--<p class="text-lg mb-2">Drag and drop your image here</p>
        <p class="text-sm text-black-500 mb-6">or</p>-->
        <button class="bg-primary text-white px-6 py-3 rounded-button hover:bg-primary/90 transition-all whitespace-nowrap">
          <i class="ri-folder-open-line ri-lg mr-2"></i>Choose File
        </button>
        <input type="file" id="file-input" accept="image/jpeg,image/png" />
        <p class="text-sm text-black-500 mt-4">Supported formats: JPG, PNG (Max size: 5MB)</p>
      </div>
    </div>
    <div id="preview-container" class="hidden mt-8">
      <div class="relative w-full max-w-md mx-auto">
        <img id="preview-image" class="w-full h-auto rounded-lg shadow-md" src="" alt="Preview" />
        <button id="remove-button" class="absolute top-2 right-2 bg-white rounded-full p-1 shadow-md hover:bg-gray-100">
          <i class="ri-close-line ri-lg text-gray-600"></i>
        </button>
      </div>
      <button id="submit-button" class="hidden w-full mt-4 bg-primary text-white px-6 py-3 rounded-button hover:bg-primary/90 transition-all whitespace-nowrap">
        <i class="ri-upload-line ri-lg mr-2"></i>Submit
      </button>
      <div id="upload-progress" class="hidden mt-4">
        <div class="bg-gray-200 rounded-full h-2">
          <div class="upload-progress bg-primary h-2 rounded-full w-0"></div>
        </div>
      </div>
    </div>
  </div>
  <div id="toast" class="fixed bottom-4 right-4 hidden">
    <div class="bg-white rounded-lg shadow-lg p-4 flex items-center">
      <i id="toast-icon" class="ri-2x mr-3"></i>
      <p id="toast-message" class="text-sm"></p>
    </div>
  </div>
</main>
<footer class="bg-primary text-white py-12">
  <div class="container mx-auto px-6">
    <div class="grid md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-xl font-bold mb-4 font-['Pacifico']">RoadMind</h3>
        <p class="text-gray-300">Revolutionizing traffic monitoring with Deep Learning technology.</p>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
        <ul class="space-y-2">
          <li><a href="/#home" class="text-gray-300 hover:text-white">Home</a></li>
          <li><a href="/#about" class="text-gray-300 hover:text-white">About</a></li>
          <li><a href="/#how-it-works" class="text-gray-300 hover:text-white">How It Works</a></li>
          <a href="/#team" class="text-gray-300 hover:text-white">Team</a>
          <li><a href="/uploadfile" class="text-gray-300 hover:text-white">Try Model</a></li>
        </ul>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-4">Resources</h4>
        <ul class="space-y-2">
          <li><a href="#" class="text-gray-300 hover:text-white">GitHub</a></li>
          <li><a href="https://www.kaggle.com/datasets/arup7365/traffic-classification-dataset/" class="text-gray-300 hover:text-white">Dataset</a></li>
        </ul>
      </div>
      <div>
        <h4 class="text-lg font-semibold mb-4">Connect</h4>
        <div class="flex space-x-4">
          <a href="#" class="text-gray-300 hover:text-white"><i class="ri-twitter-fill"></i></a>
          <a href="#" class="text-gray-300 hover:text-white"><i class="ri-linkedin-fill"></i></a>
          <a href="#" class="text-gray-300 hover:text-white"><i class="ri-github-fill"></i></a>
        </div>
      </div>
    </div>
  </div>
</footer>
<script>
  const uploadContainer = document.getElementById("upload-container");
  const fileInput = document.getElementById("file-input");
  const previewContainer = document.getElementById("preview-container");
  const previewImage = document.getElementById("preview-image");
  const removeButton = document.getElementById("remove-button");
  const uploadProgress = document.getElementById("upload-progress");
  const progressBar = document.querySelector(".upload-progress");
  const toast = document.getElementById("toast");
  const submitButton = document.getElementById("submit-button");
  const toastIcon = document.getElementById("toast-icon");
  const toastMessage = document.getElementById("toast-message");

  function showToast(type, message) {
    toastIcon.className = `ri-${type === "success" ? "checkbox-circle" : "error-warning"}-line ri-2x ${type === "success" ? "text-green-500" : "text-red-500"}`;
    toastMessage.textContent = message;
    toast.classList.remove("hidden");
    setTimeout(() => toast.classList.add("hidden"), 3000);
  }

  uploadContainer.addEventListener("click", () => fileInput.click());
  uploadContainer.addEventListener("dragover", (e) => {
    e.preventDefault();
    uploadContainer.classList.add("drag-active");
  });
  uploadContainer.addEventListener("dragleave", () => {
    uploadContainer.classList.remove("drag-active");
  });
  uploadContainer.addEventListener("drop", (e) => {
    e.preventDefault();
    uploadContainer.classList.remove("drag-active");
    handleFiles(e.dataTransfer.files);
  });
  fileInput.addEventListener("change", (e) => handleFiles(e.target.files));

  function handleFiles(files) {
    const file = files[0];
    if (!file) return;
    if (!file.type.match("image/jpeg") && !file.type.match("image/png")) {
      showToast("error", "Please upload a JPG or PNG file");
      return;
    }
    if (file.size > 5 * 1024 * 1024) {
      showToast("error", "File size must be less than 5MB");
      return;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
      previewImage.src = e.target.result;
      previewContainer.classList.remove("hidden");
      uploadContainer.classList.add("hidden");
      submitButton.classList.remove("hidden");
    };
    reader.readAsDataURL(file);
  }

  removeButton.addEventListener("click", () => {
    previewContainer.classList.add("hidden");
    uploadContainer.classList.remove("hidden");
    fileInput.value = "";
    progressBar.style.width = "0%";
    submitButton.classList.add("hidden");
  });

  submitButton.addEventListener("click", () => {
    if (!fileInput.files[0]) {
      showToast("error", "No file selected");
      return;
    }
    const formData = new FormData();
    formData.append("file", fileInput.files[0]);
    uploadProgress.classList.remove("hidden");
    submitButton.classList.add("hidden");

    fetch('/upload/', {
    method: 'POST',
    body: formData,
    headers: {
        'X-CSRFToken': "{{ csrf_token }}" // Django requires this for security
    }
})
    .then(response => {
      if (response.ok) {
        return response.text();
      } else {
        throw new Error("Upload failed");
      }
    })
    .then(html => {
      document.open();
      document.write(html);
      document.close();
    })
    .catch(() => {
      uploadProgress.classList.add("hidden");
      showToast("error", "An error occurred during upload");
    });
  });
</script>
</body>
</html>